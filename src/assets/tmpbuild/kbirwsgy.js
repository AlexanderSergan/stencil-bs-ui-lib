/*! Built with http://stenciljs.com */
const{h,Context}=window.index;class ScbFileInput{constructor(){this.files=[],this.type="primary",this.maxFiles=0,this.nodrop=!1,this.noAuto=!1,this.maxFileSize=0}componentWillLoad(){this.element=this.el;let e=this;this.element.uploadFiles=(()=>{e.uploadFiles()})}openFileInput(){this.el.getElementsByClassName("scb-fi-hidden")[0].click()}removeFile(e){let t=this.element.files,s=t[e];s.reading&&s.fileReader.abort(),s.uploading&&s.xhr.abort(),t.splice(e,1),this.element.files=[],setTimeout(()=>this.element.files=[...t])}retryUpload(e){const t=this.element.files[e];this.isLoadingAborted&&this.uploadFile(t)}uploadFiles(){this.files.forEach(e=>e.isRead&&this.uploadFile(e))}isLoadingAborted(e){return Boolean(e.uploadEnded&&100!==e.loadStatus)}cancelDefaultDragEnter(e){return e.preventDefault(),!1}cancelDefaultDragOver(e){return e.preventDefault(),!1}onDrop(e){if(event.preventDefault(),!this.nodrop){const t=e.dataTransfer;this.addFiles(t.files)}return!1}onFileSelect(e){this.addFiles(e.target.files),e.target.value=""}addFiles(e){const t=this.maxFiles-this.element.files.length;if(e.length>0&&(0===this.maxFiles||t>0)){const s=this.element.files,i=[];for(const t of(this.element.files=[],e))this.isAcceptedFileType(t)&&this.isPassedFileSize(t)&&i.push(t);this.maxFiles>0&&i.length>t&&(i.length=t),i.forEach((e,t)=>{e.elemId="file"+t+Date.now()}),setTimeout(()=>this.element.files=[...s,...i]),i.forEach(e=>this.readFile(e))}}isAcceptedFileType(e){if(!this.accept)return!0;const t=e.name.match(/\.[^\.]*$|$/)[0],s=new RegExp("^("+this.accept.replace(/[, ]+/g,"|").replace(/\/\*/g,"/.*")+")$","i");return s.test(e.type)||s.test(t)}isPassedFileSize(e){return!this.maxFileSize||e.size<=this.maxFileSize}toggleRetryBtn(e){const t=this.el.querySelector("#"+e.elemId+" .scb-fi-retry-btn"),s=this.isLoadingAborted(e);t&&t.classList.toggle("d-inline-block",s)}readFile(e){const t=new FileReader,s=this.method&&this.target&&this.formDataName;this.changeFileUploadProgress(e,0,"Start reading"),t.onprogress=(t=>{const s=Math.round(t.loaded/t.total*100);this.changeFileUploadProgress(e,s,"Reading")}),t.onloadend=(()=>{this.toggleRetryBtn(e)}),t.onload=(()=>{e.reading=!1,e.isRead=!0,this.changeFileUploadProgress(e,100,s?"Queued":""),s&&!this.noAuto&&this.uploadFile(e)}),e.reading=!0,t.readAsDataURL(e),e.fileReader=t}uploadFile(e){if(!e.uploading){const t=new XMLHttpRequest;let s;if(e.xhr=t,t.upload.onprogress=(i=>{clearTimeout(s);const a=i.loaded,l=i.total,r=Math.round(a/l*100);e.loaded=a,e.indeterminate=0>=a||a>=l,e.error?(e.status="",e.indeterminate=void 0):e.abort||(100>r?s=setTimeout(()=>{this.changeFileUploadProgress(e,r,"Stalled")},2e3):e.uploading=!1,this.changeFileUploadProgress(e,r,"Uploading"),this.el.dispatchEvent(new CustomEvent("upload-progress",{detail:{file:e,xhr:t}})))}),t.onreadystatechange=(()=>{if(4===t.readyState)if(clearTimeout(s),e.indeterminate=e.uploading=!1,e.abort)this.changeFileUploadProgress(e,e.loadStatus,"Aborted");else{if(!this.el.dispatchEvent(new CustomEvent("upload-response",{detail:{file:e,xhr:t},cancelable:!0})))return;0===t.status?e.error="Server unavailable":t.status>=500?e.error="Unexpected server error":t.status>=400&&(e.error="Forbidden"),e.complete=!1,this.el.dispatchEvent(new CustomEvent("upload-"+(e.error?"error":"success"),{detail:{file:e,xhr:t}}));let s=e.error?e.loadStatus:100,i=e.error?"Error: "+e.error:"";this.changeFileUploadProgress(e,s,i),e.uploadEnded=!0,e.uploaded=!e.error}}),t.upload.onloadstart=(()=>{this.el.dispatchEvent(new CustomEvent("upload-start",{detail:{file:e,xhr:t}}))}),t.upload.onloadend=(()=>{e.uploadEnded=!0,this.toggleRetryBtn(e)}),!this.el.dispatchEvent(new CustomEvent("upload-before",{detail:{file:e,xhr:t},cancelable:!0})))return;const i=new FormData;e.uploadTarget=this.target||"",e.formDataName=this.formDataName,this.changeFileUploadProgress(e,0,"Start uploading"),i.append(e.formDataName,e,e.name),t.open(this.method,e.uploadTarget,!0),this.configureXhr(t),e.indeterminate=!0,e.uploading=!0,e.uploadEnded=!1,e.complete=e.abort=e.error=e.held=!1,this.el.dispatchEvent(new CustomEvent("upload-request",{detail:{file:e,xhr:t,formData:i},cancelable:!0}))&&t.send(i)}}configureXhr(e){let t;if("string"==typeof this.headers)try{t=JSON.parse(this.headers.replace(new RegExp("'","g"),'"'))}catch(e){t=void 0}for(const s in t)e.setRequestHeader(s,t[s]);this.timeout&&(e.timeout=this.timeout)}changeFileUploadProgress(e,t,s){const i=this.el.querySelector("#"+e.elemId+" .progress-bar"),a=this.el.querySelector("#"+e.elemId+" .scb-fi-status");e.loadStatus=t,e.status=s,i&&(i.style.width=t+"%"),a&&(a.innerHTML=e.status||"")}render(){const e={"scb-fi-default-button":!0,btn:!0,[`btn-outline-${this.type}`]:!0},t=1!==this.maxFiles,s=t?"Upload Files":"Select File",i=t?"Drop files here...":"Drop file here...",a=this.nodrop?"":h("span",{class:"scb-fi-label"},h("slot",{name:"label"}),h("span",{class:"scb-fi-default-label"},i));let l={},r={};return this.maxFiles>0&&this.maxFiles<=this.element.files.length&&(l.disabled="disabled"),t&&(r.multiple=!0),this.accept&&(r.accept=this.accept),h("div",{class:"scb-fi-wrapper"},h("input",Object.assign({class:"scb-fi-hidden",type:"file",onChange:()=>this.onFileSelect(event)},r)),h("fieldset",Object.assign({class:"scb-fi-button-wrapper",onClick:()=>this.openFileInput()},l),h("slot",{name:"button"}),h("button",{class:e},s)),a,this.files.map((e,t)=>h("div",{class:"scb-fi-row",id:e.elemId},h("div",{class:"scb-fi-row-header"},h("span",{class:"scb-fi-name"},e.name),h("div",{class:"scb-fi-controls"},h("button",{class:{"scb-fi-icon-btn":!0,"scb-fi-retry-btn":!0,"d-inline-block":this.isLoadingAborted(e)},onClick:()=>this.retryUpload(t)},h("span",{class:"scb-icon icon-reload"})),h("button",{class:"scb-fi-icon-btn close",onClick:()=>this.removeFile(t)},h("span",{"aria-hidden":"true"},"Ã—")))),h("div",{class:"scb-fi-status"},e.status),h("div",{class:"progress"},h("div",{class:{"progress-bar":!0,[`bg-${this.type}`]:!0},style:{width:e.loadStatus+"%"},role:"progressbar","aria-valuenow":"0","aria-valuemin":"0","aria-valuemax":"100"})))))}static get is(){return"scb-file-input"}static get properties(){return{accept:{type:String,attr:"accept"},el:{elementRef:!0},element:{state:!0},files:{type:"Any"},formDataName:{type:String,attr:"form-data-name"},headers:{type:String,attr:"headers"},maxFiles:{type:Number,attr:"max-files"},maxFileSize:{type:Number,attr:"max-file-size"},method:{type:String,attr:"method"},noAuto:{type:Boolean,attr:"no-auto"},nodrop:{type:Boolean,attr:"nodrop"},target:{type:String,attr:"target"},timeout:{type:Number,attr:"timeout"},type:{type:"Any"}}}static get style(){return".scb-icon{display:inline-block;width:16px;height:16px;vertical-align:middle;opacity:.75;line-height:1}.scb-icon:focus,.scb-icon:hover{opacity:1}.scb-icon::before{content:'';display:block;width:16px;height:16px;background-size:16px;background-repeat:no-repeat}.scb-icon.icon-close::before{background-image:url(\"data:image/svg+xml;charset=utf8,%3Csvg viewBox='0 0 17 17' version='1.1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' class='si-glyph si-glyph-delete'%3E\a       %3Ctitle%3E1227%3C/title%3E\a       %3Cdefs%3E%3C/defs%3E\a       %3Cg stroke='none' stroke-width='1' fill='none' fill-rule='evenodd'%3E\a           %3Cpath d='M12.566,8 L15.611,4.956 C16.031,4.535 16.031,3.853 15.611,3.434 L12.566,0.389 C12.146,-0.031 11.464,-0.031 11.043,0.389 L7.999,3.433 L4.955,0.389 C4.534,-0.031 3.852,-0.031 3.432,0.389 L0.388,3.434 C-0.034,3.854 -0.034,4.536 0.387,4.956 L3.431,8 L0.387,11.044 C-0.034,11.465 -0.034,12.147 0.388,12.567 L3.432,15.611 C3.852,16.032 4.534,16.032 4.955,15.611 L7.999,12.567 L11.043,15.611 C11.464,16.032 12.146,16.032 12.566,15.611 L15.611,12.567 C16.031,12.146 16.031,11.464 15.611,11.044 L12.566,8 L12.566,8 Z' fill='%23434343' class='si-glyph-fill'%3E%3C/path%3E\a       %3C/g%3E\a     %3C/svg%3E\")}.scb-icon.icon-reload::before{background-image:url(\"data:image/svg+xml;charset=utf8,%3Csvg viewBox='0 0 17 16' version='1.1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' class='si-glyph si-glyph-arrow-reload'%3E\a       %3Ctitle%3E802%3C/title%3E\a       %3Cdefs%3E%3C/defs%3E\a       %3Cg stroke='none' stroke-width='1' fill='none' fill-rule='evenodd'%3E\a         %3Cg transform='translate(1.000000, 2.000000)' fill='%23434343'%3E\a           %3Cpath d='M15.796,6.908 L14.234,5.21 C14.019,4.998 13.672,4.998 13.458,5.21 L11.894,6.908 C11.679,7.122 11.679,7.467 11.894,7.68 L13.188,7.68 C12.702,9.505 11.27,10.976 9.399,11.47 C7.231,12.042 4.913,11.191 3.632,9.351 L2.541,10.102 C3.807,11.921 5.884,12.966 8.039,12.966 C8.604,12.966 9.176,12.894 9.737,12.745 C12.188,12.099 14.04,10.112 14.55,7.68 L15.795,7.68 C16.01,7.467 16.01,7.122 15.796,6.908 L15.796,6.908 Z' class='si-glyph-fill'%3E%3C/path%3E\a           %3Cpath d='M4.475,6.021 C4.69,5.808 4.69,5.462 4.475,5.249 L3.018,5.249 C3.516,3.448 4.936,2.001 6.789,1.511 C8.959,0.938 11.275,1.791 12.555,3.632 L13.647,2.88 C12.049,0.585 9.161,-0.479 6.448,0.235 C4.016,0.878 2.175,2.84 1.648,5.249 L0.196,5.249 C-0.019,5.463 -0.019,5.809 0.196,6.021 L1.834,7.658 C2.048,7.87 2.396,7.87 2.61,7.658 L4.475,6.021 L4.475,6.021 Z' class='si-glyph-fill'%3E%3C/path%3E\a         %3C/g%3E\a       %3C/g%3E\a     %3C/svg%3E\")}scb-file-input{display:block;margin-bottom:20px}scb-file-input .scb-fi-wrapper{width:100%;padding:20px;border:1px dashed #363636}scb-file-input .scb-fi-hidden{width:0;height:0;overflow:hidden;opacity:0}scb-file-input .scb-fi-button-wrapper{display:inline-block}scb-file-input .scb-fi-row-header{display:flex;justify-content:space-between}scb-file-input .scb-fi-label{display:inline-block;margin-left:10px;vertical-align:middle}scb-file-input [slot=label]+.scb-fi-default-label{display:none}scb-file-input [slot=button]+.scb-fi-default-button{display:none}scb-file-input .scb-fi-row{margin-top:10px}scb-file-input .scb-fi-icon-btn,scb-file-input .scb-fi-icon-btn:focus,scb-file-input .scb-fi-icon-btn:hover{background:0 0;outline:0;box-shadow:none;border:none;cursor:pointer;line-height:1}scb-file-input .scb-fi-wrapper .progress-bar{transition:none}scb-file-input .scb-fi-retry-btn{display:none}"}}export{ScbFileInput};